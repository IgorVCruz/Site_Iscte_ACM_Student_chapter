<ui:composition template="adminBase.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:a="http://xmlns.jcp.org/jsf/passthrough"
	xmlns:o="http://omnifaces.org/ui"
	xmlns:of="http://omnifaces.org/functions"
	xmlns:p="http://primefaces.org/ui">

	<ui:define name="content">
	
		<div class="d-sm-flex justify-content-between align-items-center mb-4">
                <h3 class="text-dark mb-0">User</h3>
        </div>
        <div class="row">
            <div class="col-md-6 col-xl-3 mb-4">
                <div class="card shadow border-left-primary py-2">
                    <div class="card-body">
                        <div class="row align-items-center no-gutters">
                            <div class="col mr-2">
                                <div class="text-uppercase text-primary font-weight-bold text-xs mb-1"><span>Users created (media per month)</span></div>
                                <div class="text-dark font-weight-bold h5 mb-0"><span>#{adminUsersBean.mediaUsersCreatedMonth}</span></div>
                            </div>
                            <div class="col-auto"><i class="far fa-eye fa-2x text-gray-300"></i></div>
                        </div>
                    </div>
                </div>
            </div>
                <div class="col-md-6 col-xl-3 mb-4">
                <div class="card shadow border-left-info py-2">
                    <div class="card-body">
                        <div class="row align-items-center no-gutters">
                            <div class="col mr-2">
                                <div class="text-uppercase text-info font-weight-bold text-xs mb-1"><span>likes (per month)</span></div>
                                <ui:remove> <div class="text-dark font-weight-bold h5 mb-0"><span>#{adminUsersBean.likesMonth}</span></div></ui:remove>
                            </div>
                            <div class="col-auto"><i class="fas fa-clipboard-list fa-2x text-gray-300"></i></div>
                        </div>
                    </div>
                </div>
            </div>
             <div class="col-md-6 col-xl-3 mb-4">
                <div class="card shadow border-left-success py-2">
                    <div class="card-body">
                        <div class="row align-items-center no-gutters">
                            <div class="col mr-2">
                                <div class="text-uppercase text-success font-weight-bold text-xs mb-1"><span>Projects developing</span></div>
                                <div class="text-dark font-weight-bold h5 mb-0"><span>#{adminProjectsBean.projectsDeveloping}</span></div>
                            </div>
                            <div class="col-auto"><i class="fas fa-dollar-sign fa-2x text-gray-300"></i></div>
                        </div>
                    </div>
                </div>
            </div>
             <div class="col-md-6 col-xl-3 mb-4">
                <div class="card shadow border-left-warning py-2">
                    <div class="card-body">
                        <div class="row align-items-center no-gutters">
                            <div class="col mr-2">
                                <div class="text-uppercase text-warning font-weight-bold text-xs mb-1"><span>Total Users </span></div>
                                <div class="text-dark font-weight-bold h5 mb-0"><span>#{adminUsersBean.totalUsers}</span></div>
                            </div>
                            <div class="col-auto"><i class="fas fa-comments fa-2x text-gray-300"></i></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
                <div style="margin-bottom: 30px;">
                    <div class="card shadow py-2" style="margin: 0 auto;">
                        <div class="card-body">
                        	 <div class="row">
							    <div class="col-6">
							        <canvas id="barChartCreatedProjects"/>
							    </div>
							    <div class="col-6">
							        <canvas id="lineChartViews"/>
							    </div>
							</div>
                        </div>
                    </div>
                </div>
                <div style="margin-bottom: 30px;">
                    <div class="card shadow py-2">
                        <div class="card-body ">
                            <h1 class="display-3 text-center">Users</h1>
	                            <h:dataTable class="table table-hover text-center table-responsive" value="#{adminUsersBean.users}" var="u" id="table">
	                            	<h:column>
	                            		<f:facet name="header">#Id</f:facet>
	                            		#{u.id}
	                            	</h:column>
	                            	<h:column>
	                            		<f:facet name="header">Username</f:facet>
	                            		#{u.username}
	                            	</h:column>
	                            	<h:column >
	                            		<f:facet name="header">Email</f:facet>
	                            		<p style="max-width:100px">#{u.email}</p>
	                            	</h:column>
	                            	<h:column>
	                            		<f:facet name="header">First Name</f:facet>
	                            		#{u.firstName}
	                            	</h:column>
	                            	<h:column>
	                            		<f:facet name="header">Last Name</f:facet>
	                            		#{u.lastName}
	                            	</h:column>
	                            	<h:column>
	                            		<f:facet name="header">Last log</f:facet>
	                            		#{u.lastLog.toString().substring(0,16)}
	                            	</h:column>
	                            	<h:column>
	                            		<f:facet name="header">Active</f:facet>
	                            		<h:panelGroup rendered="#{u.isActive()}">
	                            			<i class="fa fa-check"></i>
                            			</h:panelGroup>
                            			<h:panelGroup rendered="${not u.isActive()}">
	                            			<i class="fa fa-close"></i>
                            			</h:panelGroup>
	                            	</h:column>
	                            	<h:column>
	                            		<f:facet name="header">Acm Member</f:facet>
	                            		<h:panelGroup rendered="#{u.isMember()}">
	                            			<i class="fa fa-check"></i>
                            			</h:panelGroup>
                            			<h:panelGroup rendered="${not u.isMember()}">
	                            			<i class="fa fa-close"></i>
                            			</h:panelGroup>
	                            	</h:column>
	                            	<h:column>
	                            		<f:facet name="header">Admin</f:facet>
	                            		<h:panelGroup rendered="#{u.isAdmin()}">
	                            			<i class="fa fa-check"></i>
                            			</h:panelGroup>
                            			<h:panelGroup rendered="${not u.isAdmin()}">
	                            			<i class="fa fa-close"></i>
                            			</h:panelGroup>
	                            	</h:column>
	                            	<h:column>
	                            		<f:facet name="header">Edit</f:facet>
	                            		<h:form>
		                            		<h:commandLink class="link" >
					                        	<f:attribute name="userId" value="#{u.id}"/>
					                        	<f:ajax render=":table" execute="@this"/>
					                        	<i class="fa fa-remove"/>
					                        </h:commandLink>
	                           		    <h:link class="link" >
				                        	<f:param name="userId" value="#{u.id}" />
				                        	<i class="fa fa-eye"/>
				                        </h:link>
				                        </h:form>
	                            	</h:column>
	                            </h:dataTable>
                        </div>
                    </div>
                </div>
	</ui:define>
	
	
	<ui:define name="scripts">
		<script>
			$('.table').DataTable();
		</script>
				<!-- charts -->
		<!-- lineChart -->
		<script>
			var ctxL = document.getElementById("lineChartViews").getContext('2d');
// 		    var gradientFill = ctxL.createLinearGradient(0, 0, 0, 290);
// 		    gradientFill.addColorStop(0, "rgba(78,115,223, 1)");
// 		    gradientFill.addColorStop(1, "rgba(78,115,223, 0.1)");
		    var myLineChart = new Chart(ctxL, {
		      type: 'line',
		      data: {
		        labels: [<c:forEach items="#{adminUsersBean.getAllHours()}" var="m"> "#{m}", </c:forEach>],
		        datasets: [
		          {
		            label: "Number of logins",
		            data: [<c:forEach items="#{adminUsersBean.getLoginCounts()}" var="d"> #{d}, </c:forEach>],
		            //backgroundColor: gradientFill,
		            backgroundColor: [ 'rgba(246,248,253, 0.2)', ],
		            borderColor: [ '#4e73df', ],
		            borderWidth: 2,
		            pointBorderColor: "#4e73df", 
		            pointBackgroundColor: "rgba(78,115,223, 0.5)",
		          }
		        ]
		      },
		      options: {
		        responsive: true
		      }
		    });
	    </script>
	    
		<!-- Bar chart -->
	    <script>
			var ctxL = document.getElementById("barChartCreatedProjects").getContext('2d');
		    var gradientFill = ctxL.createLinearGradient(0, 0, 0, 290);
		    gradientFill.addColorStop(0, "rgba(78,115,223, 1)");
		    gradientFill.addColorStop(1, "rgba(78,115,223, 0.3)");
		    var myLineChart = new Chart(ctxL, {
		      type: 'bar',
		      data: {
		        labels: [ <c:forEach items="#{adminUsersBean.getLastMonths()}" var="m"> "#{m}", </c:forEach> ],
		        datasets: [
		          {
		            label: "Users created",
		            data: [<c:forEach items="#{adminUsersBean.getLastMonthsUsersCreated()}" var="d"> #{d}, </c:forEach>],
		            backgroundColor: gradientFill,
		            borderColor: [ 'rgb(78,115,223)', ],
		            borderWidth: 2,
		            pointBorderColor: "#fff",
		            pointBackgroundColor: "rgba(78,115,223, 0.1)",
		          }
		        ]
		      },
		      options: {
		        responsive: true
		      }
		    });
	    </script>
	</ui:define>

</ui:composition>